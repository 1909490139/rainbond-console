{% extends 'www/raster.html' %}
{% load i18n %}

{% block main-content %}

<div class="panel-body">
    <div class="tab-content">
        {% if fr == "local" %}
        <section class="wrapper site-min-height">
            <div class="row">
                <div class="col-lg-12 m-bot15">
                    <section class="panel">
                        <header class="panel-heading">服务列表</header>
                        <div class="panel-body  text-center">
                            {% if cacheServiceList %}
                            {% for cache in cacheServiceList %}
                            <div class="col-lg-2">
                                <h4>{{cache.service_name}}</h4>
                                <h5>{{cache.version}}</h5>
                                <button type="button" class="btn btn-success"
                                        onclick="service_create('{{tenantName}}','{{cache.service_key}}')">部署
                                </button>
                            </div>
                            {% endfor %}
                            {% endif %}
                        </div>
                    </section>
                </div>
            </div>
        </section>
        {% elif fr == "remote" %}
        <section class="wrapper site-min-height">
            <div class="row">
                <div class="col-lg-12 m-bot15">
                    <section class="panel">
                        <header class="panel-heading">远端服务列表</header>
                        <div class="panel-body  text-center" id="servicepanel">
                            <script>
                                //这里调用ajax请求云市服务数据
                                $.ajax({
                                    type : "GET",
                                    url : "/ajax/{{tenantName}}/remote/market",
                                    cache : false,
                                    beforeSend : function(xhr, settings) {
                                        var csrftoken = $.cookie('csrftoken');
                                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                                    },
                                    success : function(msg) {
                                        if (msg.success) {
                                            var dataObj = msg.data
                                            for (var i = 0; i < dataObj.length; i++){
                                                $("<div/>").addClass("col-lg-2").append(
                                                        $("<h4/>").text(dataObj[i].service_name)
                                                ).append(
                                                        $("<h5/>").text(dataObj[i].version)
                                                ).append(
                                                        $("<button/>").attr("type", "button")
                                                                .addClass("btn btn-success")
                                                                .attr("onclick", "service_create('{{tenantName}}','"+dataObj[i].service_key+"')")
                                                                .text("部署")
                                                ).appendTo($("#servicepanel"))
                                            }
                                        }
                                    },
                                    error : function() {
                                        // swal("系统异常");
                                        alert("data error");
                                    }
                                });
                            </script>
                        </div>
                    </section>
                </div>
            </div>
        </section>
        {% endif %}
    </div>
</div>

<div class="modal-body">
    <table class="table table-striped table-hover">
        {% for item in serviceList %}
        <tr>
            <td>{{item.service_key}} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="button" id="submit1"
                                                                           class="btn btn-primary" value="部署"
                                                                           onclick="deploy('{{item.service_key}}','{{tenantName}}');"/>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

{% endblock %}