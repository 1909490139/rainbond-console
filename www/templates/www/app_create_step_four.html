{% extends 'www/raster.html' %}
{% load i18n %}

{% block extracss %}
{{ block.super }}
<style>
    code {
        text-indent:0;
        border-color:#000;
        border-style:dashed;
        border-width:1px;
        display:block;
        font-size:12px;
        font-family:Courier, Calibri,"宋体";
        margin:10px 0 0 0;
        padding:10px 0 10px 5px;
        -moz-border-radius:5px;
        background:#f5f5f5;
        color:#000;
        word-wrap: break-word;
        word-break: break-all;
    }
</style>
{% endblock %}

{% block main-content%}

<section class="wrapper site-min-height">
    <section class="panel">
	    <!-- 多端口修改开始 -->
  <section class="tabbox">
      <!-- title line start -->
      <div class="tittext clearfix">
          <p style="float: left;">端口开放<span>(配置变化后需重启)</span></p>
          <p style="float: left;"><button type="button" class="btn btn-success btn-xs" id="add_service_port">新增服务端口</button>
          </p>
      </div>
      <!-- title line end -->
      <div id="port_open"></div>
      <!-- table start -->
      {% for port in ports %}
      <table class="table table-striped table-advance table-hover newtab">
          <!--  表格 头  开始 -->
          <thead>
              <tr port="{{port.container_port}}">
                <th>端口号:
                    {% if port_auth %}
                        <a href="#" class="edit-port" data-title="更改监听端口" data-url="/ajax/{{tenantName}}/{{serviceAlias}}/ports/{{port.container_port}}" data-value="{{port.container_port}}"></a>
                    {% else %}
                        {{port.container_port}}
                    {% endif %}
                </th>
                <th>协议类型:
                    {% if port_auth %}
                            <a href="#" class="edit-protocol" data-title="更改协议类型" data-url="/ajax/{{tenantName}}/{{serviceAlias}}/ports/{{port.container_port}}" data-value="{{port.protocol}}"></a>
                        {% else %}
                            {{port.protocol}}
                        {% endif %}
                </th>
                <th>
                    <button type="button" class="port-delete btn btn-danger btn-xs" ><i class="fa fa-times"></i></button>
                </th>
              </tr>
          </thead>
          <!--  表格 头  结束 -->
          <!-- 表格 内容  开始 -->
          <tbody>
              <tr port="{{port.container_port}}">
                  <td>
                    <span>对内服务:</span>
                    <input class="switch-box" name="inner" type="checkbox" {% if port.is_inner_service %}checked{% endif %} data-size="mini" data-on-color="info" data-on-text="开启" data-off-text="关闭">
                  </td>
                  <td>
                      <span>服务地址:</span>
                      <p class="fn-sever-link" id="sever_show_{{port.container_port}}" port="{{port.container_port}}">
                          <span></span>
                      </p>
                  </td>
                  <td>
                      <span>使用别名:</span>
                      {% if port_auth %}
                          <a href="#" class="edit-port-alias" data-title="更改别名" data-url="/ajax/{{tenantName}}/{{serviceAlias}}/ports/{{port.container_port}}" data-value="{{port.port_alias}}"></a>
                      {% else %}
                          {{port.port_alias}}_HOST:{{port.port_alias}}_PORT
                      {% endif %}
                  </td>
              </tr>
              <tr port="{{port.container_port}}">
                  <td class="fn-out-servce">
                     <span>外部访问:</span>
                     <input class="switch-box" name="outer" type="checkbox" {% if port.is_outer_service %}checked{% endif %} data-size="mini" data-on-color="success" data-on-text="开启" data-off-text="关闭">
                  </td>
                  <td>
                     <span>访问地址:</span>
                     <p class="fn-sever-link" id="port_show_{{port.container_port}}" port="{{port.container_port}}">
                          <a href="" target="_blank"></a>
                     </p>
                  </td>
                  <td>
                    <div id="showLink{{port.container_port}}">
                     {% if port.is_outer_service %}
                     <span>绑定域名:</span>
                     <input type="text" class="form-control" id="service_app_name_{{port.container_port}}" {% if port.container_port in serviceDomainDict.keys %}value="{{serviceDomainDict|mkey:port.container_port}}"{% endif %} placeholder="请输入新域名，如：www.example.com">
                       {% if 'manage_service' in user.actions %}
                        <p style="padding-top: 10px;">
                          {% if port.container_port in serviceDomainDict.keys %}
                          <button type="button" class="btn btn-danger btn-xs" onclick="domainSubmit('close','{{tenantServiceInfo.service_id}}','{{tenantName}}','{{tenantServiceInfo.service_alias}}','{{port.container_port}}')">解绑</button>
                          {% else %}
                          <button type="button" class="btn btn-success btn-xs" onclick="domainSubmit('start','{{tenantServiceInfo.service_id}}','{{tenantName}}','{{tenantServiceInfo.service_alias}}','{{port.container_port}}')">绑定</button>
                          {% endif %}
                        </p>
                      {% endif %}
                    {% endif %}
                    </div>
                  </td>
              </tr>
          </tbody>
          <!-- 表格 内容  结束 -->
      </table>
      {% endfor %}
      <!-- table end -->
  </section>
  <!-- 多端口修改结束 -->
    </section>
</section>
{% endblock %}
