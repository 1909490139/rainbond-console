{% extends 'www/base.html' %}
{% load i18n %}
{% load staticfiles %}
{% load crispy_forms_tags %}

{% block title %}好雨云平台 用户注册{% endblock %}

{% block extracss %}
    <link rel="stylesheet" href="{% static "www/css/style.css" %}">
    <link rel="stylesheet" href="{% static "www/css/style-responsive.css" %}">
    <link rel="stylesheet" href="{% static "www/css/login.css" %}">
{% endblock %}

{% block bodyclass %}login-body{% endblock %}

{% block body %}
 <!--
 <header class="header white-bg">
    <a href="/" class="logo">好雨<span>云平台</span></a>
</header>
-->
<div class="mainbox">
    <h1 class="yblogo"><img src="static/www/images/yunbanglogo.png"></h1>

  <form id="reg_form" class="form-signin-w form-signin-reg-w" enctype="multipart/form-data" action="" method="post">
    
    {% if errors %}
    <div class="alert alert-danger alert-dismissable">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        {% blocktrans count counter=errors|length %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
    </div>
    {{ form.non_field_errors }}
    {% endif %}
    <!-- 	{% crispy form %} -->
    <div class="form-group">
        <input type="text" class="form-control" id="" placeholder="请输入团队名">
    </div>
    <div class="form-group">
        <input type="text" class="form-control" id="" placeholder="请输入用户名">
    </div>
    <div class="form-group">
        <input type="email" class="form-control" id="" placeholder="请输入邮箱(选填)">
    </div>
    <div class="form-group">
        <input type="password" class="form-control" id="" placeholder="请设置密码，至少包含8位字符">
    </div>
    <div class="linkfw text-center">点击注册表示你已阅读并同意《<a href="">云帮公有云版服务条款</a>》</div>
    <button type="submit" class="btn btn-success btn-block">注&nbsp;&nbsp;册</button>
    <p class="text-center">或使用以下账号注册</p>
    <a href="" class="weixin"><img src="static/www/images/weixin.png">&nbsp;微信</a>
    <div class="linkregister text-center">已有云帮公有云版账户，直接<a href="login.html">登录</a></div>
    <a href="http://www.goodrain.com/" class="linkgood text-center">goodrain.com</a>

  </form>
  
  <script>
   var InterValObj; //timer变量，控制时间
   var count = 90; //间隔函数，1秒执行
   var curCount;//当前剩余秒数
  
  	function getPhoneCode(){
  		curCount = count;
  		var phone = $("#id_phone").val()
  		if(phone==""){
  			swal("手机号不能为空")
  			return false;
  		}
  		var captcha_code = $("#id_captcha_code").val()
  		if(captcha_code==""){
  			swal("请输入图形验证码")
  			return false;
  		}
  		$("#PhoneCodeBtn").attr("disabled", "true");
  		$.ajax({
    		type : "POST",
    		url : "/phone_code",
    		data : "phone="+phone+"&captcha_code="+captcha_code,
    		cache : false,
    		beforeSend : function(xhr, settings) {
    			var csrftoken = $.cookie('csrftoken');
    			xhr.setRequestHeader("X-CSRFToken", csrftoken);
    		},
    		success : function(msg) {
    			var dataObj = msg
    			if (dataObj["status"] == "success") {
    				swal("发送成功")
    				InterValObj = window.setInterval(SetRemainTime, 1000);
    			} else if(dataObj["status"] == "often"){
    				swal("请稍后发送")
    				$("#PhoneCodeBtn").removeAttr("disabled");
    			}else if(dataObj["status"] == "errorcaptchacode"){
    				swal("图片验证码异常")
    				$("#PhoneCodeBtn").removeAttr("disabled");
    			}else if(dataObj["status"] == "errorphone"){
    				swal("错误的手机号")
    				$("#PhoneCodeBtn").removeAttr("disabled");
    			}else if(dataObj["status"] == "limited"){
    				swal("超过发送次数")
    				$("#PhoneCodeBtn").removeAttr("disabled");
    			} else {
    				swal("发送失败")
    				$("#PhoneCodeBtn").removeAttr("disabled");
    			}
    		},
    		error : function() {
    			// swal("系统异常");
    		}
    	})
    	return false;
  	}
  	function SetRemainTime() {
        if (curCount == 0) {                
            window.clearInterval(InterValObj);//停止计时器
            $("#PhoneCodeBtn").removeAttr("disabled");//启用按钮
            $("#PhoneCodeBtn").val("重新发送验证码");
        }
        else {
            curCount--;
            if(curCount==0){
            	$("#PhoneCodeBtn").html("请输入手机验证码");
            }else{
            	$("#PhoneCodeBtn").html("请在" + curCount + "秒内输入手机验证码");
            }
        }
    }
  	
  	function refresh(){
  		var img = document.getElementById("captcha_code");  
        img.src = "/captcha?rnd=" + Math.random();  
  	}
  	
  </script>
</div>
{% endblock %}

{% block extrajs %}
  <!--script type="text/javascript">
    $('#reg_form').validator();
  </script-->
{% endblock %}