<!-- statistic start -->
<div role="tabpanel" class="tab-pane active" id="statistic">
    <input type="hidden" id="websocketUrl" name="websocketUrl" value="{{ websocket_uri }}">
    {% if statistic_type == 'history' %}
        <div>
            <div class="col-xs-9"></div>
            <div class="col-xs-3">
                <select id="graph-period" class="form-control input-sm m-bot15">
                    <option value="1h-ago">1小时</option>
                    <option value="8h-ago">8小时</option>
                    <option value="24h-ago">24小时</option>
                    <option value="7d-ago">7天</option>
                </select>
            </div>
        </div>
        {% if hasHttpServices %}
            <div class="row">
                <div class="col-md-6">
                    <section class="panel">
                        <header class="panel-heading">
                            响应时间 (5分钟平均值)
                        </header>
                        <div class="panel-body">
                            <div id="response-time-stat" class="graph">
                                <svg></svg>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="col-md-6">
                    <section class="panel">
                        <header class="panel-heading">
                            在线人数 (10分钟)
                        </header>
                        <div class="panel-body">
                            <div id="online-stat" class="graph">
                                <svg></svg>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <section class="panel">
                        <header class="panel-heading">
                            吞吐率 (1分钟总数)
                        </header>
                        <div class="panel-body">
                            <div id="throughput-stat" class="graph">
                                <svg></svg>
                            </div>
                        </div>
                    </section>
                </div>

            </div>
        {% endif %}<!--end http_history-->
        {% if tenantServiceInfo.service_type == "mysql" %}
            <div class="row">
                <div class="col-md-6">
                    <section class="panel">
                        <header class="panel-heading">
                            sql响应时间 (5分钟平均值)
                        </header>
                        <div class="panel-body">
                            <div id="sqltime-stat" class="graph">
                                <svg></svg>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="col-md-6">
                    <section class="panel">
                        <header class="panel-heading">
                            sql执行次数 (1分钟总数)
                        </header>
                        <div class="panel-body">
                            <div id="sql-throughput-stat" class="graph">
                                <svg></svg>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        {% endif %}

        <div class="row">
            <div class="col-md-6">
                <section class="panel">
                    <header class="panel-heading">
                        内存
                    </header>
                    <div class="panel-body">
                        <div id="memory-stat" class="graph">
                            <svg></svg>
                        </div>
                    </div>
                </section>
            </div>

            <div class="col-md-6">
                <section class="panel">
                    <header class="panel-heading">
                        带宽
                    </header>
                    <div class="panel-body">
                        <div id="bandwidth-stat" class="graph">
                            <svg></svg>
                        </div>
                    </div>
                </section>
            </div>

            <div class="col-md-6">
                <section class="panel">
                    <header class="panel-heading">
                        磁盘
                    </header>
                    <div class="panel-body">
                        <div id="disk-stat" class="graph">
                            <svg></svg>
                        </div>
                    </div>
                </section>
            </div>

        </div>

    {% endif %}<!--end statistic_history-->
    {% if statistic_type == 'realtime' %}
        {% if hasHttpServices %}
            <div id="realtime-stat" class="weather-category twt-category rtm-category rtm-category-3">
                <ul>
                    <li>
                        <h1 id="response-time-stat">0</h1>
                        平均响应时间
                    </li>
                    <li>
                        <h1 id="throughput-stat">0</h1>
                        吞吐率
                    </li>
                    <li>
                        <h1 id="online-stat">0</h1>
                        在线人数
                    </li>
                </ul>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            过去5分钟耗时最多的URl排行
                            <span class="pull-right rtm-update-time"></span>
                        </header>
                        <table id="rtm-SumTimeByUrl" class="table table-striped table-advance table-hover">
                            <thead>
                            <tr>
                                <th name="url" class="text-left col-md-8">Url</th>
                                <th name="sumtime" class="text-right col-md-2">累计时间(ms)</th>
                                <th name="avgtime" class="text-right col-md-1">平均时间(ms)</th>
                                <th name="counts" class="text-right col-md-1">个数</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </section>
                </div>
            </div>
        {% endif %}<!--finish http_realtime-->

        {% if tenantServiceInfo.service_type == 'mysql' %}
            <div id="realtime-stat" class="weather-category twt-category rtm-category rtm-category-2">
                <ul>
                    <li>
                        <h1 id="sqltime-stat">0</h1>
                        sql平均响应时间
                    </li>
                    <li>
                        <h1 id="sql-throughput-stat">0</h1>
                        sql吞吐率
                    </li>
                </ul>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            过去5分钟耗时最多的SQL排行
                            <span class="pull-right rtm-update-time"></span>
                        </header>
                        <table id="rtm-SumTimeBySql" class="table table-striped table-advance table-hover">
                            <thead>
                            <tr>
                                <th name="sql" class="text-left col-md-8">SQL</th>
                                <th name="sumtime" class="text-right col-md-2">累计时间(ms)</th>
                                <th name="avgtime" class="text-right col-md-1">平均时间(ms)</th>
                                <th name="counts" class="text-right col-md-1">个数</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </section>
                </div>
            </div>
        {% endif %}<!--finish mysql_realtime-->

    {% endif %}<!--finish realtime-->

    <div class="row">
        <table class="table table-striped table-advance table-hover">
            <thead>
            <tr>
                <th>编号</th>
                <th>规则</th>
            </tr>
            </thead>
            <tbody id="ruleBody">

            </tbody>
        </table>
        <button id="shuaxin" class="btn btn-info">刷新</button>
        <form>
            <select name="item">
                <option value="tp">吞吐率</option>
                <option value="rt">响应时间</option>
                <option value="on">在线人数</option>
            </select>
            <select name="operator">
                <option value=">">大于</option>
                <option value="<">小于</option>
                <option value="=">等于</option>
            </select>
            <input name="value" value="1000"/>
            <input name="fortime" value="20"/>
            <select name="action">
                <option value="add">扩容</option>
                <option value="del">压缩</option>
            </select>
            <input type="submit" value="提交" class="btn btn-info">
        </form>
    </div>
    <script>
        $("#shuaxin").click(function () {
            $.ajax({
                type: "GET",
                url: "/ajax/{{tenantName}}/{{serviceAlias}}/rule",
                data: "",
                cache: false,
                beforeSend: function (xhr, settings) {
                    var csrftoken = $.cookie('csrftoken');
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                },
                success: function (data) {
                    if (data.status == "success") {
                        $("#ruleBody").html("")
                        tbody = ""
                        $.each(data.data, function (id, rule) {
                            trStr = ""
                            if (rule.item == "tp") {
                                trStr = "<tr><td>" + id + "</td><td>当吞吐率" + rule.operator + " " + rule.value + " 并持续" + rule.fortime + "秒的时候," + rule.action + "一个实例</td><td><button class=\"btn btn-danger\" onclick=\"del('" + id + "')\">删除</button></td></tr>";
                            }
                            if (rule.item == "rt") {
                                trStr = "<tr><td>" + id + "</td><td>当响应时间" + rule.operator + " " + rule.value + " 并持续" + rule.fortime + "秒的时候," + rule.action + "一个实例</td><td><button class=\"btn btn-danger\" onclick=\"del('" + id + "')\">删除</button></td></tr>";
                            }
                            if (rule.item == "on") {
                                trStr = "<tr><td>" + id + "</td><td>当在线人数" + rule.operator + " " + rule.value + " 并持续" + rule.fortime + "秒的时候," + rule.action + "一个实例</td><td><button class=\"btn btn-danger\" onclick=\"del('" + id + "')\">删除</button></td></tr>";
                            }
                            tbody = tbody + trStr
                        })
                        $("#ruleBody").html(tbody)
                    }
                },
                error: function () {
                    swal("系统异常");
                }
            })
        })

        $("input[type='submit']").click(function () {

            item = $("select[name='item']").val()
            operator = $("select[name='operator']").val()
            value = $("input[name='value']").val()
            fortime = $("input[name='fortime']").val()
            action = $("select[name='action']").val()

            data = {
                item: item,
                operator: operator,
                value: value,
                fortime: fortime,
                action: action,
            }
            $.ajax({
                type: "POST",
                url: "/ajax/{{tenantName}}/{{serviceAlias}}/rule",
                data: data,
                cache: false,
                beforeSend: function (xhr, settings) {
                    var csrftoken = $.cookie('csrftoken');
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                },
                success: function (data) {
                    swal("添加结果" + data.status);
                },
                error: function () {
                    swal("系统异常");
                }
            })

            return false;
        })

        function del(id) {
            $.ajax({
                type: "POST",
                url: "/ajax/{{tenantName}}/{{serviceAlias}}/rule/delete",
                data: {id: id},
                cache: false,
                beforeSend: function (xhr, settings) {
                    var csrftoken = $.cookie('csrftoken');
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                },
                success: function (data) {
                    if (data.status == "success") {
                        swal("删除成功");
                    } else {
                        swal("删除失败" + data.message);
                    }
                },
                error: function () {
                    swal("系统异常");
                }
            })
        }
    </script>
</div>
<!-- statistic end-->