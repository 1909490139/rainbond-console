{% extends 'www/raster.html' %}
{% load i18n %}

{% block main-content%}
<div class="row">
   <div class="col-lg-12">
       <section class="panel">
           <header class="panel-heading">应用创建向导</header>
           <div class="panel-body">
               <div class="stepy-tab"><ul id="default-titles" class="stepy-titles clearfix">
               
               <li id="default-title-0" class="current-step"><div>第一步</div><span> </span></li>
               <li id="default-title-1" class=""><div>第二步 </div><span> </span></li>
               <li id="default-title-2" class=""><div>第三步</div><span> </span></li>
               
               </ul></div>
               <form class="form-horizontal" id="default">
                  <input type="hidden" id="tenantName" name="tenantName" value="{{tenantName}}">
                  <fieldset title="Step1" class="step" id="default-step-0" style="display: block;">
					<section class="panel">
					   <header class="panel-heading">名称</header>
					     <div class="panel-body">
					       <div class="form-group">
					         <label class="col-xs-2 control-label">应用名称</label>
					           <div class="col-xs-10">
					             <input type="text" name="service_name" id="service_name" value="" class="form-control servicename" placeholder="应用名称" autofocus>
					           </div>
					       </div>
					       <div class="form-group">
					         <label class="col-xs-2 control-label">描述信息</label>
					           <div class="col-xs-10">
					             <input type="text" class="form-control servicename" value="" name="service_desc" id="service_desc" placeholder="简短的描述信息">
					           </div>
					       </div>
                <div class="form-group">
                  <label class="col-xs-2 text-right">开发语言支持</label>
                  <label class="col-xs-10">PHP(5.4~5.6)、Python(2.4x~3.4.x)、Ruby(2.0~2.2)、Node.JS、Java、Clojure、Scala 更多开发语言后续版本支持。</label>
                </div>
					     </div>
					 </section>
					<section class="panel">
					  <header class="panel-heading">代码</header>
					    <div class="panel-body">
					      <div class="col-lg-12 radio">
					        <div class="row">
					          <div class="col-xs-2">
					            <label><input type="radio" name="optionsRadios" id="optionsRadios1" value="option1" checked="">新建代码仓库</label>
					          </div>
					          <div class="col-xs-2">
					            <label><input type="radio" value="option2" name="optionsRadios" id="optionsRadios2" disabled="">导入现有代码</label>
					          </div>
					          <div class="col-xs-2">
					            <label><input type="radio" value="option3" name="optionsRadios" id="optionsRadios3" disabled="">连接Github</label>
					          </div>
					        </div>
					      </div>
					    </div>
					</section>
                    <p id="default-buttons-0" class="default-buttons"><a id="default-next-0" href="javascript:void(0);" onclick=create_next() class="button-next  btn btn-info">下一步</a></p>
                  </fieldset>
                  <fieldset title="Step 2" class="step" id="default-step-1" style="display: none;">
					<section class="panel">
					    <header class="panel-heading">新建服务</header>
					    <div class="panel-body">
					      {% if cacheServiceList %}
                  			{% for cache in cacheServiceList %}
                  				<div class="col-xs-2">
							        <label class="checkbox-inline">
							          <input type="checkbox" name="inlineCheckbox1" value="{{cache.service_key}}_{{cache.service_type}}"> {{cache.service_name}}
							        </label>
					         	 </div>
                  			{% endfor %}
                  		 {% endif %}
                  		  <input type="hidden" id="createService" name="createService" value="">
						 </div>
					</section>
					<section class="panel">
					    <header class="panel-heading">选择已有服务</header>
					     <div class="panel-body">
					     
					     {% if deployTenantServices %}
                  			{% for deployCache in deployTenantServices %}
                  				<div class="col-xs-2">
							        <label class="checkbox-inline">
							          <input type="checkbox" name="delineCheckbox1" value="{{deployCache.service_id}}_{{deployCache.service_type}}"> {{deployCache.service_alias}}
							        </label>
					         	 </div>
                 			{% endfor %}
                 		{% endif %}
                 		<input type="hidden" id="hasService" name="hasService" value="">
					    </div>
					</section>
	                <p id="default-buttons-1" class="default-buttons"><a id="default-back-1" href="javascript:void(0);" onclick=create_pre() class="button-back btn btn-info">上一步</a><a id="default-next-1" href="javascript:void(0);" onclick=create_next2() class="button-next  btn btn-info">下一步</a></p>
                  </fieldset>
                  <fieldset title="Step 3" class="step" id="default-step-2" style="display: none;">
                      <div class="form-group">
                          <label class="col-xs-2 control-label">应用名称</label>
                          <div class="col-xs-10">
                              <p class="form-control-static" id="display_service_name"></p>
                          </div>
                      </div>
                      <div class="form-group">
                          <label class="col-xs-2 control-label">描述信息</label>
                          <div class="col-xs-10">
                              <p class="form-control-static" id="display_service_desc"></p>
                          </div>
                      </div>
                      <div class="form-group">
                          <label class="col-xs-2 control-label">代码仓库</label>
                          <div class="col-xs-10">
                              <p class="form-control-static" id="display_service_code_http"></p>
                          </div>
                      </div>
                      <!--<div class="form-group">
                          <label class="col-lg-2 control-label">SSH:</label>
                          <div class="col-lg-10">
                              <p class="form-control-static" id="display_service_code_ssh"></p>
                          </div>
                      </div>
                      <div class="form-group">
                          <label class="col-lg-2 control-label">HTTP:</label>
                          <div class="col-lg-10">
                              <p class="form-control-static" id="display_service_code_http"></p>
                          </div>
                      </div>-->
                      <div class="form-group">
                          <label class="col-xs-2 control-label">服务依赖</label>
                          <div class="col-xs-10">
                              <p class="form-control-static" id="display_service_dependency"></p>
                          </div>
                      </div>
                      <p id="default-buttons-2" class="default-buttons">
                      <a id="default-back-2" href="javascript:void(0);" onclick=create_pre2() class="button-back btn btn-info">上一步</a>
                      <button class="finish btn btn-success" type="button" id="submit1" name="submit1" onclick=appCreate('{{tenantName}}')>完成</button>
                      </p>
                  </fieldset>
               </form>
           </div>
       </section>
       
       <script>

      	function create_next(){
	      	var service_name = $("#service_name").val();
			var serviceReg = /^[a-zA-Z][a-zA-Z0-9_-]*$/;
			var result = true;
			if (!serviceReg.test(service_name)) {
				alert("应用名称以英文字母开始包含数字，中划线 -，下划线 _")
				result = false;
				$('#service_name').focus();
			}
			if (!result) {
				return;
			}
      		$("#default-title-1").attr("class","current-step");
      		$("#default-title-0").attr("class","");
      		$("#default-title-2").attr("class","");
      		$("#default-step-0").css('display','none'); 
      		$("#default-step-1").css('display','block'); 
      		$("#default-step-2").css('display','none'); 
        }
		function create_next2(){
			$("#default-title-1").attr("class","");
      		$("#default-title-0").attr("class","");
      		$("#default-title-2").attr("class","current-step");
      		$("#default-step-0").css('display','none'); 
      		$("#default-step-1").css('display','none'); 
      		$("#default-step-2").css('display','block');
      		$("#display_service_name").html($("#service_name").val());
      		$("#display_service_desc").html($("#service_desc").val());
      		$("#display_service_code_ssh").html("git@code.goodrain.com:app/"+$("#tenantName").val()+"_"+$("#service_name").val()+".git");
      		$("#display_service_code_http").html("http://code.goodrain.com/app/"+$("#tenantName").val()+"_"+$("#service_name").val()+".git");
      		
      		var serviceType = new Array();
      		var serviceKey="";
      		var serviceId="";
      		
      		$("input[name='inlineCheckbox1']:checkbox").each(function(){ 
			  if($(this).is(":checked")){
			     var str=$(this).val().split("_");
			     if(str.length==2){
			     	if(serviceKey!=""){
			     		serviceKey=serviceKey+","
			     	}
			     	if($.inArray(str[1],serviceType) < 0){
			     		serviceType.push(str[1])
			     	}
			     	serviceKey = serviceKey+str[0] 
			     }
			  }
			});
			
			$("#createService").val(serviceKey)
			
			$("input[name='delineCheckbox1']:checkbox").each(function(){ 
			  if($(this).is(":checked")){
			  	var str=$(this).val().split("_");
			    if(str.length==2){
			     	if(serviceId != ""){
			     		serviceId=serviceId+","
			     	}
			     	if($.inArray(str[1],serviceType) < 0){
			     		serviceType.push(str[1])
			     	}
			     	serviceId = serviceId+str[0] 
			     }
			  }
			});
			
			$("#hasService").val(serviceId)
						
			$("#display_service_dependency").html(serviceType.join(","));

		}

      	function create_pre(){
      		$("#default-title-0").attr("class","current-step")
      		$("#default-title-1").attr("class","");
      		$("#default-title-2").attr("class","");
      		$("#default-step-0").css('display','block'); 
      		$("#default-step-1").css('display','none'); 
      		$("#default-step-2").css('display','none'); 
        }
        
		function create_pre2(){
			$("#default-title-0").attr("class","");
      		$("#default-title-1").attr("class","current-step");
      		$("#default-title-2").attr("class","");
      		$("#default-step-0").css('display','none'); 
      		$("#default-step-1").css('display','block'); 
      		$("#default-step-2").css('display','none'); 
		}
      	
      	
       </script>
       
  </div>
</div>
{% endblock %}