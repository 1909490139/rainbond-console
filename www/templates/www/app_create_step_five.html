{% extends 'www/raster.html' %}
{% load i18n %}
{% load staticfiles %}
{% block extracss %}
{{ block.super }}
<link rel="stylesheet" href='{% static "www/css/base.css" %}' />
<link rel="stylesheet" href='{% static "www/css/newapp.css" %}' />
<link rel="stylesheet" href='{% static "www/css/newappstep.css" %}' />
{% endblock %}
{% block extrajs %}
<script src='{% static "www/js/newcompose.js" %}'></script>
<script src='{% static "www/js/bootstrap-editable.min.js" %}'></script>
{% endblock %}

{% block main-content%}

<section class="wrapper site-min-height">
    <input type="hidden" id="image_url" value="{{image_url}}">
    <input type="hidden" id="tenantNameValue" value="{{tenantName}}">
    <input type="hidden" id="compose_file_id" value="{{compose_file_id}}">
    <input type="hidden" id="parse_error" value="{{parse_error}}">
    <input type="hidden" id="compose_relations" value="{{compose_relations}}">
    <section class="main-box">
        <div class="app-step clearfix two">
            <p><span>1</span><cite>设置镜像来源</cite></p>
            <p class="sed"><span>2</span><cite>设置应用参数</cite></p>
        </div>
        <!-- start -->
        <div class="tablink">
            <a href="javascript:;" class="sed">总览</a>
            {% for service in service_list %}
            <a href="javascript:;" >{{service.name}}</a>
            {% endfor %}
        </div>
        <!-- 总览 start -->
        <section id="overview" class="fn-app-box" style="display: block;">
            <div class="view-svg" id="view-svg">
                
            </div>
        </section>
        <!-- 总览 end -->
        <!-- 01-->
        {% for service in service_list %}
        <input type="hidden" name="depends_on" value="{{service.depends_on}}">
        <input type="hidden" name="image" value="{{service.image}}">
        <section id="{{service.service_id}}" service_cname="{{service.name}}" service_image="{{service.image}}" class="app-box fn-app-box"  style="none: block;" >
            <!-- 应用端口 start -->
            <section class="box-single">
                <h3>应用端口</h3>
                <table class="tab-box">
                    <thead>
                    <tr>
                        <th>端口</th>
                        <th>对外服务</th>
                        <th>外部访问</th>
                        <th colspan="2">访问方式</th>
                    </tr>
                    </thead>
                    <tbody class="port">
                    {% for outer_port in service.ports %}
                    <tr data-port="{{outer_port}}port">
                        <td>
                            <a href="javascript:void(0);" class="portNum edit-port fn-tips" data-tips="源码中无 Dockerfile 文件时，默认开启服务端口为5000，请勿随意更改。如果当前应用为多端口应用，请根据您编码中定义的端口自行添加。">{{outer_port}}</a>
                        </td>
                        <td>
                            <div class="checkbox fn-tips" data-tips="打开对外服务，其他应用即可访问当前应用。">
                                <input  type="checkbox" name="" value="" id="{{outer_port}}inner" />
                                <label class="check-bg" for="{{outer_port}}inner"></label>
                            </div>
                        </td>
                        <td>
                            <div class="checkbox fn-tips" data-tips="打开外部访问，用户即可通过互联网访问当前应用。">
                                <input class="checkDetail" type="checkbox" name="" value="" id="{{outer_port}}outer" />
                                <label class="check-bg" for="{{outer_port}}outer"></label>
                            </div>
                        </td>
                        <td>
                            <select disabled="disabled" style="color: #838383;" data-port-http="{{inner_port}}Http" class="fn-tips" data-tips="如果允许用户通过互联网采用HTTP协议访问当前应用，请选择HTTP。">
                                <option class="changeOption">请打开外部访问</option>
                                <option>HTTP</option>
                                <option>非HTTP</option>
                            </select>
                        </td>
                        <td>
                            <img class="rubbish" src="{% static "www/images/rubbish.png" %}"/>
                        </td>
                    </tr>
                    {% endfor %}

                    {% for inner_port in service.expose %}
                    <tr data-port="{{inner_port}}port">
                        <td>
                            <a href="javascript:void(0);" class="portNum edit-port fn-tips" data-tips="源码中无 Dockerfile 文件时，默认开启服务端口为5000，请勿随意更改。如果当前应用为多端口应用，请根据您编码中定义的端口自行添加。">{{inner_port}}</a>
                        </td>
                        <td>
                            <div class="checkbox fn-tips" data-tips="打开对外服务，其他应用即可访问当前应用。">
                                <input  type="checkbox" name="" value="" id="{{inner_port}}inner"/>
                                <label class="check-bg" for="{{inner_port}}inner"></label>
                            </div>
                        </td>
                        <td>
                            <div class="checkbox fn-tips" data-tips="打开外部访问，用户即可通过互联网访问当前应用。">
                                <input class="checkDetail" type="checkbox" name="" value="" id="{{inner_port}}outer"/>
                                <label class="check-bg" for="{{inner_port}}outer"></label>
                            </div>
                        </td>
                        <td>
                            <select disabled="disabled" style="color: #838383;" data-port-http="{{inner_port}}Http" class="fn-tips" data-tips="如果允许用户通过互联网采用HTTP协议访问当前应用，请选择HTTP。">
                                <option class="changeOption">请打开外部访问</option>
                                <option>HTTP</option>
                                <option>非HTTP</option>
                            </select>
                        </td>
                        <td>
                            <img class="rubbish" src="{% static "www/images/rubbish.png" %}"/>
                        </td>
                    </tr>
                    {% endfor %}

                    </tbody>
                    <tfoot>
                        <tr class="addPort" style="display: none">
                            <td>
                                <input type="number" class="add_port fn-tips" data-tips="为了保证安全，服务端口支持范围为 1025~65535，如您的编码中提供对外服务端口不在此范围内，请修改编码。">
                                <p class="checkTip">请输入正确的端口号</p>
                            </td>
                            <td>
                                <div class="checkbox fn-tips" data-tips="打开对外服务，其他应用即可访问当前应用。">
                                    <input type="checkbox" name="" value="" id="addInner{{service.service_id}}" checked="checked" />
                                    <label class="check-bg" for="addInner{{service.service_id}}"></label>
                                </div>
                            </td>
                            <td>
                                <div class="checkbox fn-tips" data-tips="打开外部访问，用户即可通过互联网访问当前应用。">
                                    <input class="checkDetail" type="checkbox" name="" value="" id="addOuter{{service.service_id}}" checked="checked" />
                                    <label class="check-bg" for="addOuter{{service.service_id}}"></label>
                                </div>
                            </td>
                            <td>
                                <select class="add_http fn-tips" data-tips="如果允许用户通过互联网采用HTTP协议访问当前应用，请选择HTTP。">
                                    <option>HTTP</option>
                                    <option>非HTTP</option>
                                </select>
                            </td>
                            <td class="operation">
                                <span class="add lit-btn-green"><i class="fa fa-check"></i></span>
                                <span class="noAdd lit-btn-red"><i class="fa fa-times"></i></span>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="5" style="text-align: center">
                                <span class="openAdd">新增容器端口</span>
                            </td>
                        </tr>
                    </tfoot>
                </table>


            </section>
            <!-- 应用端口 end -->
            <!-- 环境变量 start -->
            <section class="box-single">
                <h3>环境变量</h3>
                <table class="tab-box">
                    <thead>
                        <tr>
                            <th>名称</th>
                            <th>变量名</th>
                            <th>值</th>
                            <th>删除</th>
                        </tr>
                    </thead>
                    <tbody class="enviroment">
                    {% for k,v in service.environment.items %}


                    <tr>
                        <td><a href="javascript:void(0);"
                               class="enviromentName edit-port editable editable-click">{{k}}</a></td>
                        <td><a href="javascript:void(0);" class="edit-port enviromentKey key1 editable editable-click">{{k}}</a>
                        </td>
                        <td><a href="javascript:void(0);"
                               class="edit-port enviromentValue value1 editable editable-click">{{v}}</a></td>
                        <td><img class="rubbish" src="/static/www/images/rubbish.png"></td>
                    </tr>

                    {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr class="addContent" style="display: none">
                            <td>
                                <input type="text" class="enviroName">
                            </td>
                            <td>
                                <input type="text" class="enviroKey">
                                <p class="checkTip">变量名由大写字母开头，可以加入数字</p>
                            </td>
                            <td>
                                <input type="text" class="enviroValue">
                            </td>
                            <td class="operation">
                                <span class="addEnviroment lit-btn-green"><i class="fa fa-check"></i></span>
                                <span class="noAddEnviroment lit-btn-red"><i class="fa fa-times"></i></span>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4" style="text-align: center">
                                <span class="openAddEnviroment">新增环境变量</span>
                            </td>
                        </tr>
                    </tfoot>
                </table>

            </section>

            <div class="contentBlock">
                <b>应用持久化目录：</b>
                <p class="tips">当前应用所在目录为/app/，使用持久化目录，请注意路径关系</p>
                <ul class="clearfix">
                    {% for volume in service.volumes %}
                    <li>/app/{{volume}}</li>
                    {% endfor %}
                </ul>
                <p class="catalogue">
                    /app/<input type="text" class="catalogueContent">
                    <span class="addCatalogue lit-btn-green"><i class="fa fa-check"></i></span>
                    <span class="noAddCatalogue lit-btn-red"><i class="fa fa-times"></i></span>
                    <span class="checkTip" style="margin-left: 20px">请输入目录</span>
                </p>
                <p class="blockBottom">
                    <button class="addCata">为当前应用新设持久化目录</button>
                </p>
            </div>

            <!-- 持久化目录 end-->
            <!--依赖服务 start -->
            {% if service.depends_on|length > 0 or service.links|length > 0 %}
            <div class="serviceBlock">
                <h4 class="column-tit">服务依赖</h4>
                <div class="contentBlock">
                    <b>依赖的服务：</b>
                    <ul class="depends_service">
                        {% for dep in service.depends_on %}
                        <li>{{dep}}</li>
                        {% endfor %}
                        {% for link in service.links %}
                        <li>{{link}}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
            <!--依赖服务 end-->

            <div class="serviceBlock">
                <h4 class="column-tit">启动命令</h4>
                <textarea rows="4" cols="60" class="order" >{% if service.command %}{{service.command}}{% endif %}</textarea>
            </div>
            <!-- 启动命令 end -->


        </section>
        {% endfor %}
        <!-- 01-->
        <!-- 02-->
        {% if parse_error %}
            <section>
                <h4> 解析出错</h4>
                <h5>{{parse_error_info}}</h5>
            </section>
        {% endif %}

        <!-- 02-->
        <!-- 03-->

        <!-- 03-->
        <!-- 提交 start -->
        <div class="build-app-btn">
            <a href="javascript:;" class="btn btn-info" id="pre_page">上一页</a>
            {% if not parse_error %}
            <a href="javascript:;" class="btn  btn-success" id="build-app">建立一组应用</a>
            {% endif %}
        </div>
        <!-- 提交 end -->
        <!-- end -->
    </section>
</section>
{% endblock %}
