{% extends 'www/raster.html' %}{% load i18n %} {% load goodrain_extras %}
{% load crispy_forms_tags %}
{% load staticfiles %}

{% block extracss %}
    {{ block.super }}
    <link rel="stylesheet" href='{% static "www/css/base.css" %}'/>
    <link rel="stylesheet" href='{% static "www/css/newappstep.css" %}'/>
{% endblock %}

{% block extrajs %}
    <script src='{% static "www/js/app_create_docker_3.js" %}'></script>
    <script src='{% static "www/js/bootstrap-editable.min.js" %}'></script>
{% endblock %}

{% block main-content %}
    <section class="wrapper site-min-height">
        <!-- start -->
        <section class="main-box">
            <input type="hidden" id="tenantName" value="{{ tenantName }}">
            <input type="hidden" id="service_id" value="{{ service_id }}">
            <input type="hidden" id="service_name" value="{{ service_cname }}">
            <input type="hidden" id="service_alias" value="{{ service_alias }}">

            <h3 class="main-tit">从镜像创建应用</h3>
            <div class="app-step clearfix three">
                <p class="sed"><span>1</span><cite>创建应用</cite></p>
                <p class="sed"><span>2</span><cite>应用设置</cite></p>
                <p><span>3</span><cite>高级选项</cite></p>
            </div>
            <h4 class="column-tit">部署方式</h4>
            <div class="form-group">
                <select style="min-width:100px;max-width: 300px;" name="extend_method" id="extend_method"
                        class="form-control m-bot15">
                    <option value="stateless" selected="selected">无状态</option>
                    <option value="state">有状态</option>
                </select>
                <p class="state-tips fn-stateless">无状态应用具有以下特点：应用实例共享存储（或无需持久化存储），实例可无序水平伸缩。
                    <span>状态设置后不可修改，请谨慎选择！</span></p>
                <p class="state-tips fn-state" style="display: none;">
                    有状态应用具有以下特点：应用每个实例具有自己的存储（并可使用本地存储类型），实例顺序启动和关闭，每个实例具有确定且唯一的主机名。如果你的应用属于数据型，集群型，有状态服务是你的首选。<span>状态设置后不可修改，请谨慎选择！</span>
                </p>
            </div>
            <h4 class="column-tit">端口管理<span style="font-size:12px;vertical-align:middle">(如需设置请参照镜像官方文档)</span></h4>
            <table class="tab-box">
                <thead>
                <tr>
                    <th>端口</th>
                    <th>对外服务</th>
                    <th>外部访问</th>
                    <th colspan="2">访问方式</th>
                </tr>
                </thead>
                <tbody class="port" id="docker_port">
                <!--
                {% for port in service_ports %}
                <tr>
                    <td>
                        <a href="javascript:void(0);" class="portNum edit-port fn-tips" data-tips="当前应用提供服务的端口号。">
                    {{port.container_port}}</a>
                    </td>
                    <td>
                        <div class="checkbox fn-tips" data-tips="打开对外服务，其他应用即可访问当前应用。">
                            <input type="checkbox" name="" value="" id="{{port.container_port}}inner"
                    {% if port.is_inner_service %}checked="true" {% endif %}/>
                            <label class="check-bg" for="{{port.container_port}}inner"></label>
                        </div>
                    </td>
                    <td>
                        <div class="checkbox fn-tips" data-tips="打开外部访问，用户即可通过网络访问当前应用。">
                            <input class="checkDetail" type="checkbox" name="" value="" id="{{port.container_port}}
                    outer"  {% if port.is_outer_service %}checked="true" {% endif %}/>
                            <label class="check-bg" for="{{port.container_port}}outer"></label>
                        </div>
                    </td>
                    <td>
                        <select data-port-http="5000Http" class="fn-tips" data-tips="请设定用户的访问协议。"
                    {% if port.is_outer_service %} {% else %} style="color: #838383;" disabled=true {% endif %}>
                            {% if port.is_outer_service %}
                            <option {% if port.protocol == 'http' %} selected = "selected" {% endif %}>HTTP</option>
                            <option {% if port.protocol == 'stream' %} selected = "selected" {% endif %}>非HTTP</option>
                            {% else %}
                            <option class="changeOption">请打开外部访问</option>
                            <option>HTTP</option>
                            <option>非HTTP</option>
                            {% endif %}
                        </select>
                    </td>
                    <td>
                        <img class="rubbish" src="{% static "www/images/rubbish.png" %}"/>
                    </td>
                </tr>
                {% endfor %}
                -->
                </tbody>
                <tfoot>
                <tr class="addPort" style="display: none">
                    <td>
                        <input type="number" class="add_port fn-tips" data-tips="请根据当前镜像提供服务的端口号填写。">
                        <p class="checkTip">请输入正确的端口号</p>
                    </td>
                    <td>
                        <div class="checkbox fn-tips" data-tips="打开对外服务，其他应用即可访问当前应用。">
                            <input type="checkbox" name="" value="" id="addInner" checked="checked"/>
                            <label class="check-bg" for="addInner"></label>
                        </div>
                    </td>
                    <td>
                        <div class="checkbox fn-tips" data-tips="打开外部访问，用户即可通过网络访问当前应用。">
                            <input class="checkDetail" type="checkbox" name="" value="" id="addOuter"
                                   checked="checked"/>
                            <label class="check-bg" for="addOuter"></label>
                        </div>
                    </td>
                    <td>
                        <select class="add_http fn-tips" data-tips="请设定用户的访问协议。">
                            <option>HTTP</option>
                            <option>非HTTP</option>
                        </select>
                    </td>
                    <td class="operation">
                        <span class="add lit-btn-green"><i class="fa fa-check"></i></span>
                        <span class="noAdd lit-btn-red"><i class="fa fa-times"></i></span>
                    </td>
                </tr>
                <tr>
                    <td colspan="5" style="text-align: center">
                        <span class="openAdd">新增端口</span>
                    </td>
                </tr>
                </tfoot>
            </table>
            <h4 class="column-tit">内存选项<span style="font-size: 14px;">(单节点内存)</span></h4>
            <div class="contentBlock">
                <div class="fm-range clearfix">
                    <!--
                    <label class="labeltext">单节点内存</label>
                    -->
                    {% if is_tenant_free %}
                        <p class="range-box fn-tips" data-tips="新用户单应用内存最大1G，全部应用总内存最大1G。付费用户无限制。">
                            <input type="range" min="512" max="1024" step="128" id="MemoryRange" value="512" ／>
                        </p>

                    {% else %}
                        <p class="range-box fn-tips" data-tips="单应用内存最大8G，总内存无限。如需使用更多，请联系客服申请。">
                            <input type="range" min="512" max="8192" step="128" id="MemoryRange" value="512" ／>
                        </p>
                        <!-- no user -->
                    {% endif %}
                    <span id="MemoryText" class="fm-text">512M</span>
                </div>
            </div>
            <div class="clearfix">
                <div class="serviceBlock">
                    <h4 class="column-tit">服务依赖</h4>
                    <div class="contentBlock">
                        <ul class="clearfix applicationName">
                        </ul>
                        <p class="blockBottom">
                            <button class="addDepend">新增依赖</button>
                        </p>
                    </div>
                    <div class="fileBlock">
                        <h4 class="column-tit">文件存储</h4>
                        <div class="contentBlock">
                            <ul class="clearfix">

                            </ul>
                            <p class="catalogue">
                                <input type="text" class="catalogueName" placeholder="请输入挂载名称">
                                <input type="text" class="catalogueContent" placeholder="请输入目录">
                                <select>
                                    <option value="share-file">共享存储(文件)</option>
                                    <option value="memoryfs">内存文件存储</option>
                                </select>
                                <span class="addCatalogue lit-btn-green"><i class="fa fa-check"></i></span>
                                <span class="noAddCatalogue lit-btn-red"><i class="fa fa-times"></i></span>
                                <span class="checkTip" style="margin-left: 20px">请输入目录</span>
                            </p>
                            <p class="blockBottom">
                                <button class="addCata">为当前应用新设持久化目录</button>
                                <button class="addOtherApp">挂载其他应用的持久化目录</button>
                            </p>
                        </div>
                    </div>
                    <h4 class="column-tit">环境变量</h4>
                    <table class="tab-box">
                        <thead>
                        <tr>
                            <th>名称</th>
                            <th>变量名</th>
                            <th>值</th>
                            <th>删除</th>
                        </tr>
                        </thead>
                        <tbody class="enviroment">

                        </tbody>
                        <tfoot>
                        <tr class="addContent" style="display: none">
                            <td>
                                <input type="text" class="enviroName">
                            </td>
                            <td>
                                <input type="text" class="enviroKey">
                                <p class="checkTip">变量名由大写字母与数字组成且大写字母开头</p>
                            </td>
                            <td>
                                <input type="text" class="enviroValue">
                            </td>
                            <td class="operation">
                                <span class="addEnviroment lit-btn-green"><i class="fa fa-check"></i></span>
                                <span class="noAddEnviroment lit-btn-red"><i class="fa fa-times"></i></span>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="4" style="text-align: center">
                                <span class="openAddEnviroment">新增环境变量</span>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                    <!--镜像地址 -->
                    <div class="fn-mirroraddress">
                        <h4 class="column-tit">镜像地址</h4>
                        <div class="contentBlock">

                        </div>
                    </div>
                    <!--镜像地址 -->
                    <!-- 容器运行命令 -->
                    <div class="fn-run-command">
                        <h4 class="column-tit">容器运行命令</h4>
                        <div class="contentBlock">

                        </div>
                    </div>
                    <!-- 容器运行命令 -->
                </div>
                <p class="next">
                    <button class="submit">下一步</button>
                </p>
        </section>
        <!-- end -->
    </section>
    <!-- layer start -->
    <div class="layer-body-bg">
        <div class="layer-body">
            <!-- 01 start -->
            <div class="depend">
                <div class="del" title="关闭"><i class="fa fa-times"></i></div>
                <p class="layer-tit">新增依赖</p>
                <div class="layer-height-overflow">
                    <ul class="clearfix">
                        {% for deployTenantService in openInnerServices %}
                            <li class="clearfix">
                                <input type="checkbox" class="cho-input"
                                       value="{{ deployTenantService.service_id }}_{{ deployTenantService.service_type }}_{{ deployTenantService.version }}"
                                       data-action="{{ deployTenantService.service_cname }}_{{ deployTenantService.version }}"
                                       data-id="{{ deployTenantService.service_id }}"
                                       id="{{ deployTenantService.service_id }}"
                                       data-serviceId="{{ deployTenantService.service_id }}">
                                <label class="cho-bg" for="{{ deployTenantService.service_id }}"></label>
                                <label for="{{ deployTenantService.service_id }}"
                                       class="cho-text">{{ deployTenantService.service_cname }}_{{ deployTenantService.version }}</label>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <p class="bottom">
                    <button class="sureAddDepend btn-success">确认</button>
                    <button class="cancel">取消</button>
                </p>
            </div>
            <!-- 01 end -->
            <!-- 02 start -->
            <div class="applicationMes">
                <div class="del" title="关闭"><i class="fa fa-times"></i></div>
                <div class="appendDiv layer-height-overflow">

                </div>
                <p class="bottom">
                    <button class="cancel">关闭</button>
                </p>
            </div>
            <!-- 02 end -->
            <!-- 03 start -->
            <div class="otherApp">
                <div class="del" title="关闭"><i class="fa fa-times"></i></div>
                <p class="layer-tit">挂载其他应用</p>
                <div class="layer-height-overflow">
                    <table class="tab-box lit">
                        <thead>
                        <tr>
                            <th>服务名称</th>
                            <th>共享目录</th>
                            <th>持久化类型</th>
                            <th>所属应用</th>
                            <th>所属应用组</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for shared_vol in shared_vols %}
                            <tr>
                                <td>{{ shared_vol.dep_app_name }}</td>
                                <td>{{ shared_vol.dep_vol_path }}</td>
                                <td>共享存储(文件)</td>
                                <td>{{ shared_vol.dep_app_name }}</td>
                                <td>{{ shared_vol.dep_app_group }}</td>
                                <td class="text-center">
                                    <input type="checkbox" class="addOther cho-input"
                                           data-name="{{ shared_vol.dep_app_name }}"
                                           data-path="{{ shared_vol.dep_vol_path }}"
                                           id="{{ shared_vol.dep_vol_id }}">
                                    <label class="cho-bg" for="{{ shared_vol.dep_vol_id }}"
                                           data-for="{{ shared_vol.dep_app_name }}"></label>
                                </td>
                            </tr>
                        {% endfor %}
                        <!--
                        {#                        {% for tenantSer in tenantServiceList %}#}
                        {#                            <tr>#}
                        {#                                <td>{{ tenantSer.service_cname }}</td>#}
                        {#                                <td>/mnt/{{ tenantSer.service_alias }}</td>#}
                        {#                                <td class="text-center">#}
                        {#                                    <input type="checkbox" class="addOther cho-input"#}
                        {#                                           data-name="{{ tenantSer.service_cname }}" class="cho-input"#}
                        {#                                           data-path="/mnt/{{ tenantSer.service_alias }}"#}
                        {#                                           data-otherName="{{ tenantSer.service_alias }}"#}
                        {#                                           id="{{ tenantSer.service_cname }}">#}
                        {#                                    <label class="cho-bg" for="{{ tenantSer.service_cname }}"></label>#}
                        {#                                </td>#}
                        {#                            </tr>#}
                        {#                        {% endfor %}#}
                        -->
                        </tbody>
                    </table>
                </div>
                <p class="bottom">
                    <button class="sureAddOther btn-success">确认</button>
                    <button class="cancel">取消</button>
                </p>
            </div>
            <!-- 03 end -->
        </div>
    </div>
    <!-- layer end -->
{% endblock %}
