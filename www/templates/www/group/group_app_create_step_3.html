{% extends 'www/raster.html' %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load goodrain_extras %}

{% load staticfiles %}
{% block extracss %}
{{ block.super }}
<link rel="stylesheet" href='{% static "www/css/base.css" %}' />
<link rel="stylesheet" href='{% static "www/css/newapp.css" %}' />
<link rel="stylesheet" href='{% static "www/css/newappstep.css" %}' />
{% endblock %}

{% block main-content%}

<section class="wrapper site-min-height">
    <input type="hidden" id="service_group_id" value={{group_id}}>
    <input type="hidden" id="shared_group_id" value={{shared_group_id}}>
    <input type="hidden" id="tenantNameValue" value="{{tenantName}}">
    <section class="main-box">
        <h3 class="main-tit">创建组应用</h3>
        <div class="app-step clearfix three">
            <p class="sed"><span>1</span><cite>组信息</cite></p>
            <p class="sed"><span>2</span><cite>创建应用</cite></p>
            <p class="sed"><span>3</span><cite>应用设置</cite></p>
        </div>
        <div class="tablink">
            {% for service in service_list %}
            <a href="javascript:;">{{service_cname_map|mkey:service.service_key}}</a>
            {% endfor %}
        </div>
        {% for service in service_list %}
        <section class="app-box fn-app-box" data-key="{{service.service_key}}" data-version="{{service.version}}" data-id="{{service.ID}}">
            <!-- 部署方式 start-->
            <h4 class="column-tit">部署方式</h4>
            <div class="form-group">
                <select style="min-width:100px;max-width: 300px;" name="{{service.ID}}_extend_method" id="{{service.ID}}_extend_method" class="form-control m-bot15">
                      <option value="stateless" selected="selected">无状态</option>
                      <option value="state" >有状态</option>
                 </select>
                 <p class="state-tips" id="{{service.ID}}_fn_stateless">无状态应用具有以下特点：应用实例共享存储（或无需持久化存储），实例可无序水平伸缩。  <span>状态设置后不可修改，请谨慎选择！</span></p>
                 <p class="state-tips" id="{{service.ID}}_fn_state" style="display: none;">有状态应用具有以下特点：应用每个实例具有自己的存储（并可使用本地存储类型），实例顺序启动和关闭，每个实例具有确定且唯一的主机名。如果你的应用属于数据型，集群型，有状态服务是你的首选。<span>状态设置后不可修改，请谨慎选择！</span></p>
            </div>
            <!-- 部署方式 end -->
            <h4 class="column-tit">端口管理</h4>
            <table class="tab-box">
                <thead>
                <tr>
                    <th>端口</th>
                    <th>协议</th>
                    <th>对内服务</th>
                    <th>对外服务</th>
                </tr>
                </thead>
                <tbody class="port">
                {% with service_port_list=app_port_map|mkey:service.service_key %}
                {% for service_port in service_port_list %}
                <tr>
                    <td>{{service_port.container_port}}</td>
                    <td>{{service_port.protocol}}</td>
                    <td>
                        <div class="checkbox">
                            <input type="checkbox" name="" value="" id="{{service_port.container_port}}inner" {% if service_port.is_inner_service %}checked="true"{% endif %} disabled="disabled"/>
                            <label class="check-bg" for="{{service_port.container_port}}inner"></label>
                        </div>
                    </td>
                    <td>
                        <div class="checkbox">
                            <input class="checkDetail" type="checkbox" name="" value="" id="{{service_port.container_port}}outer" {% if service_port.is_outer_service %}checked="true"{% endif %} disabled="disabled"/>
                            <label class="check-bg" for="{{service_port.container_port}}outer"></label>
                        </div>
                    </td>
                </tr>
                {% endfor %}
                {% endwith %}
                </tbody>
            </table>
            <!-- 内存 start -->
            <h4 class="column-tit">内存选项<span style="font-size: 14px;">(单节点内存)</span></h4>
            <div class="contentBlock">
                <div class="fm-range clearfix">
                    <!--
                    <label class="labeltext">单节点内存</label>
                    -->
                    {% if is_tenant_free %}
                    <p class="range-box fn-tips" data-tips="新用户单应用内存最大1G，全部应用总内存最大1G。付费用户无限制。">
                        {% with service_min_memory=app_min_memory_map|mkey:service.service_key %}
                        <input type="range" min="{{service_min_memory}}" max="1024"  step="128" id="{{service.ID}}_MemoryRange" value="{{service_min_memory}}"／>
                        {% endwith %}
                    </p>
                    
                    {% else %}
                    <p class="range-box fn-tips" data-tips="单应用内存最大8G，总内存无限。如需使用更多，请联系客服申请。">
                        {% with service_min_memory=app_min_memory_map|mkey:service.service_key %}
                        <input type="range" min="{{service_min_memory}}" max="8192"  step="128" id="{{service.ID}}_MemoryRange" value="{{service_min_memory}}"／>
                        {% endwith %}
                    </p>
                    <!-- no user -->
                    {% endif %}
                    <span id="{{service.ID}}_MemoryText" class="fm-text"></span>
                </div>
            </div>
            <!-- 内存  end -->
            <div class="serviceBlock">
                <h4 class="column-tit">服务依赖</h4>
                <table class="tab-box">
                    <thead>
                    <tr>
                        <th>应用名称</th>
                        <th>应用版本</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% with dep_service_list=app_relation_map|mkey:service.service_key %}
                    {% for dep_service in dep_service_list %}
                    <tr>
                        <td>{{dep_service.dep_app_alias}}</td>
                        <td>{{dep_service.dep_app_version}}</td>
                    </tr>
                    {% endfor %}
                    {% endwith %}
                    </tbody>
                </table>
            </div>

            <!--环境变量-->
            <h4 class="column-tit">环境变量</h4>
            <table class="tab-box">
                <thead>
                <tr>
                    <th>变量名称</th>
                    <th>变量值</th>
                </tr>
                </thead>
                <tbody class="environment">
                {% with env_list=app_env_map|mkey:service.service_key %}
                {% for env in env_list %}
                <tr>
                    {% if 'direct_copy' in env.options %}
                    <!-- SITE_URL 和 TRUSTED_DOMAIN 参数不显示-->
                    <td name="attr_name" >{{env.attr_name}}</td>
                    <td name="attr_value">{{env.attr_value}}</td>
                    {% else %}
                    <td name="attr_name">{{env.attr_name}}</td>
                    <td><input name="attr_value" placeholder="举例: {{env.attr_value}}"></td>
                    {% endif %}
                </tr>
                {% endfor %}
                {% endwith %}
                </tbody>
            </table>
        </section>
        {% endfor %}
        <p class="text-center">
            <button class="greenbtn" id="group_install_three" style="cursor: pointer;">下一步</button>
        </p>
    </section>
</section>
{% endblock %}
{% block extrajs %}
<script src='{% static "www/js/groupinstall/group-step-three.js" %}'></script>
{% endblock %}