{% extends 'www/raster.html' %}
{% load i18n %}
{% load staticfiles %}
{% block extracss %}
{{ block.super }}
<link rel="stylesheet" href='{% static "www/css/base.css" %}' />
<link rel="stylesheet" href='{% static "www/css/newappstep.css" %}' />
{% endblock %}

{% block main-content%}

<section class="wrapper site-min-height">
    <!--
    <section class="panel-body">
        <input type="hidden" id="tenantNameValue" value="{{tenantName}}">
        <input type="hidden" id="service_id" value="{{service_id}}">
        <div class="steptit">
            <span class="sed">1，设置镜像来源</span>
            <span class="hidden-xs">2，设置应用参数</span>
        </div>
        <span class="line"></span>
        <div class="fm-link">
            <form>
                <!--ggg{{image_url}}{{service_id}}-->
                <!--
                <p><label>镜像地址：</label><input type="text" id="mirror-address" value="{{image_url}}" placeholder="例如 nginx:1.11"/></p>
                <a href="javascript:;" class="btn btn-success" id="nextstep">下一步</a>
            </form>
        </div>
    </section>
    -->

    <!-- new start -->
    <section class="main-box">
        <h3 class="main-tit">创建镜像应用</h3>
        <div class="app-step clearfix two">
            <p class="sed"><span>1</span><cite>创建应用</cite></p>
            <p><span>2</span><cite>应用设置</cite></p>
        </div>
        <form class="cmxform form-horizontal tasi-form" id="commentForm" method="post" action="" novalidate="novalidate">
            <input type="hidden" id="tenantName" name="tenantName" value="{{tenantName}}" />
            <input type="hidden" id="service_key" name="service_key" value="{{service_key}}" />
            <input type="hidden" id="app_version" name="app_version" value="{{app_version}}" />
            <input type="hidden" id="service_id" value="{{service_id}}">
            <!-- -->
            <input type="hidden" id="pre_paid_memory_price" name="pre_paid_memory_price" value="{{pre_paid_memory_price}}">
            <input type="hidden" id="post_paid_memory_price" name="post_paid_memory_price" value="{{post_paid_memory_price}}">
            <input type="hidden" id="pre_paid_disk_price" name="pre_paid_disk_price" value="{{pre_paid_disk_price}}">
            <input type="hidden" id="post_paid_disk_price" name="post_paid_disk_price" value="{{post_paid_disk_price}}">
            <input type="hidden" id="post_paid_net_price" name="post_paid_net_price" value="{{post_paid_net_price}}">
            <!-- -->
            <input type="hidden" id="is_tenant_free" name="is_tenant_free" value="{{is_tenant_free}}">
            <!-- 基本信息  start-->
            <div class="infor-fm-box">
                <h4 class="step-tit" style="display:none;">基本信息</h4>
                <div class="fm-input-text clearfix">
                    <label for="create_app_name">应用名</label><input type="text" id="create_name" name="create_name" value="" placeholder="请输入应用名，支持中英文"  />
                </div>
                <p class="fm-tips" id="create_name_notice">请输入应用名！</p>
                <div class="fm-select clearfix">
                    <label>选择分组</label>
                    <select id="group-name" name="select_group_id">
                        <option value="-1">不分组</option>
                        {% for group in groupList %}
                        <option value="{{group.ID}}" >{{group.group_name}}</option>
                        {% endfor %}
                        <option value="-2">新建组</option>
                    </select>
                </div>
                <div class="fm-input-text clearfix">
                    <label for="create_app_name">镜像地址</label><input type="text" id="mirror-address" name="mirror-address" value="{{image_url}}" placeholder="例如 nginx:1.11"  />
                </div>
                <p class="fm-tips" id="mirror_address_notice">您还没有输入镜像地址！</p>
            </div>
            <!-- 基本信息  end -->
            <!-- 配套信息 start -->
            <div class="infor-fm-box">
                <h4 class="step-tit" style="display:none;">配套信息</h4>
                <!-- 01 -->
                <div class="fm-input-range clearfix fn-memory-node">
                    <label>应用单节点内存</label>
                    {% if is_tenant_free %}
                    <p class="range-box nouser fn-tips" data-tips="新用户单应用内存最大1G，全部应用总内存最大1G。付费用户单应用内存最大8G，总内存无限制。">
                        <span class="renge-bg"></span>
                        <span class="range-choose"><cite id="OneMemoryWid"></cite></span>
                        <input type="range" min="128" max="1024"  step="128" id="OneMemory" value="128"／>
                    </p>
                    <!-- user -->
                    {% else %}
                    <!-- no user -->
                    <p class="range-box">
                        <span class="renge-bg"></span>
                        <span class="range-choose"><cite id="OneMemoryWid"></cite></span>
                        <input type="range" min="128" max="8192"  step="128" id="OneMemory" value="128"／>
                    </p>
                    <!-- no user -->
                    {% endif %}
                    <span><cite id="OneMemoryText">128M</cite></span>
                </div>
                <div class="fm-input-range clearfix fn-memory-node" >
                    <label>节点数</label>
                    {% if is_tenant_free %}
                    <p class="range-box nouser02 fn-tips" data-tips="新用户单应用只能创建1个节点，付费用户可创建100个节点。">
                        <span class="renge-bg"></span>
                        <span class="range-choose"><cite id="NodeWid"></cite></span>
                        <input type="range" min="1" max="1"  step="1" id="NodeNum" value="1"／>
                    </p>
                    <!-- user -->
                    {% else %}
                    <!-- no user -->
                    <p class="range-box">
                        <span class="renge-bg"></span>
                        <span class="range-choose"><cite id="NodeWid"></cite></span>
                        <input type="range" min="1" max="100"  step="1" id="NodeNum" value="1"／>
                    </p>
                    <!-- no user -->
                    {% endif %}
                    <span><cite id="NodeText">1</cite>个</span>
                </div>
				<div style="display:none;">
                <div class="fm-input-radio clearfix" style="padding-bottom:30px;">
                    <label>内存使用方式</label>
                    <input type="radio" name="Memory" value="After" id="MoneyAfter" checked="true"/>
                    <label class="radio-bg"  for="MoneyAfter"></label>
                    <label for="MoneyAfter" class="radio-text fn-tips" data-tips="内存按小时扣费，支持随时扩容和缩容，适用于高速发展中的项目。可转为预付费模式，即时生效。">每小时扣费</label>
                    <input type="radio" name="Memory" value="Before" id="MoneyBefore"  />
                    <label class="radio-bg" for="MoneyBefore"></label>
                    <label for="MoneyBefore" class="radio-text fn-tips" data-tips="预付费采购内存，整体费用相对便宜，但不支持缩容，适用于相对稳定的项目。若要转为每小时扣费，在当前付费周期结束后才会生效。">预付费</label>
                </div>
                <!-- 02 -->
                <div class="fm-choose-box clearfix">
                    <label>磁盘存储</label>
                    <div class="btn-cho-box clearfix">
                        <p class="clearfix"><input type="checkbox" id="fbscc" checked="true" disabled="true" /><label class="cho-bg" for="fbscc"></label><label for="fbscc" class="cho-text">分布式存储</label></p>
                        <p class="clearfix"><input type="checkbox" id="ssd" checked="true"  disabled="true" /><label class="cho-bg" for="ssd"></label><label for="ssd" class="cho-text">SSD</label></p>
                    </div>
                </div>
                <div class="fm-input-radio clearfix">
                    <label>磁盘使用方式</label>
                    <input type="radio" name="Disk" value="DiskAfter" id="DiskAfter" checked="true" />
                    <label class="radio-bg"  for="DiskAfter"></label>
                    <label for="DiskAfter" class="radio-text fn-tips" data-tips="存储按小时扣费，由于存储量是逐步增多的，所以很合算，适用于发展中的项目。可转为预付费模式，即时生效。">按使用每小时扣费</label>
                    <input type="radio" name="Disk" value="DiskBefore" id="DiskBefore"  />
                    <label class="radio-bg" for="DiskBefore"></label>
                    <label for="DiskBefore"  class="radio-text fn-tips" data-tips="提前定额采购存储，整体费用相对便宜，但不支持缩容，适用于相对稳定的项目。若要转为按使用付费，在当前付费周期结束后才会生效。">提前定额购买</label>
                </div>
                <div class="fm-input-range clearfix fn-disk" style="display: none;">
                    <label>购买额度</label>
                    {% if is_tenant_free %}
                    <p class="range-box nouser02 fn-tips" data-tips="新用户单应用可购买容量最大1G，付费用户最大1000G。" >
                        <span class="renge-bg"></span>
                        <span class="range-choose"><cite id="DiskWid"></cite></span>
                        <input type="range" min="1" max="1"  step="1" id="Disk" value="1"／>
                    </p>
                    <!-- user -->
                    {% else %}
                    <!-- no user -->
                    <p class="range-box">
                        <span class="renge-bg"></span>
                        <span class="range-choose"><cite id="DiskWid"></cite></span>
                        <input type="range" min="1" max="1000"  step="1" id="Disk" value="1"／>
                    </p>
                    <!-- no user -->
                    {% endif %}
                    <span><cite id="DiskText">1</cite>G</span>
                </div>
                <!-- 03 -->
                <div class="fm-input-radio clearfix" style="padding-bottom:30px; padding-top: 30px;">
                    <label>外网访问流量</label>
                    <input type="radio" name="flow" value="flow" id="flow" checked="true" />
                    <label class="radio-bg" for="flow"></label>
                    <label  class="radio-text fn-tips" for="flow" data-tips="应用只有开放对外访问才会计算流量，目前仅支持按使用每小时扣费，请保持账户有一定余额。">按使用每小时扣费</label>
                </div>
                <!--
                <div class="fm-text clearfix">
                    <label>预估费用:</label>
                    <span><cite>12</cite>元／月</span>
                </div>
                -->
                <!-- 04 -->
                <div class="fm-choose-box clearfix">
                    <label>部署支持</label>
                    <div class="btn-cho-box clearfix">
                        <p class="clearfix"><input type="checkbox" id="yjbs" checked="true" disabled="true" /><label class="cho-bg" for="yjbs"></label><label for="yjbs" class="cho-text">一键部署</label></p>
                        <p class="clearfix"><input type="checkbox" id="yjhg" checked="true"  disabled="true" /><label class="cho-bg" for="yjhg"></label><label for="yjhg" class="cho-text">一键回滚</label></p>
                        <p  class="clearfix"><input type="checkbox" id="gdsj" checked="true" disabled="true" /><label class="cho-bg" for="gdsj"></label><label for="gdsj" class="cho-text">滚动升级</label></p>
                    </div>
                </div>
                <div class="fm-choose-box clearfix">
                    <label>资源支持</label>
                    <div class="btn-cho-box clearfix">
                        <p class="clearfix"><input type="checkbox" id="dlzy" checked="true" disabled="true" /><label class="cho-bg" for="dlzy"></label><label for="dlzy" class="cho-text">独立资源</label></p>
                        <p class="clearfix"><input type="checkbox" id="fzjh" checked="true" disabled="true" /><label class="cho-bg" for="fzjh"></label><label for="fzjh" class="cho-text">负载均衡</label></p>
                        <p class="clearfix"><input type="checkbox" id="txss" checked="true" disabled="true" /><label class="cho-bg" for="txss"></label><label for="txss" class="cho-text">弹性伸缩</label></p>
                        <p class="clearfix"><input type="checkbox" id="gky" checked="true" disabled="true" /><label class="cho-bg" for="gky"></label><label for="gky" class="cho-text">高可用</label></p>
                        <p class="clearfix"><input type="checkbox" id="sfkz" checked="true" disabled="true" /><label class="cho-bg" for="sfkz"></label><label for="sfkz" class="cho-text">三份快照</label></p>
                    </div>
                </div>
                <div class="fm-choose-box clearfix">
                    <label>日志监控</label>
                    <div class="btn-cho-box clearfix">
                        <p class="clearfix"><input type="checkbox" id="xnfxgj" checked="true" disabled="true" /><label class="cho-bg" for="xnfxgj"></label><label for="xnfxgj" class="cho-text">性能分析/告警</label></p>
                        <p class="clearfix"><input type="checkbox" id="ywjkgj" checked="true" disabled="true" /><label class="cho-bg" for="ywjkgj"></label><label for="ywjkgj" class="cho-text">业务监控/告警</label></p>
                        <p class="clearfix"><input type="checkbox" id="fbsrz" checked="true" disabled="true" /><label class="cho-bg" for="fbsrz"></label><label for="fbsrz" class="cho-text">分布式日志</label></p>
                    </div>
                </div>
				</div>
            </div>
            <!-- 配套信息 end -->
            <!-- 费用估算 start -->
            <div class="infor-fm-box" style="border-bottom: 0 none;display:none;">
                <h4 class="step-tit">费用估算</h4>
                <div class="fm-input-range clearfix">
                    <label>应用购买时长</label>
                    <p class="range-box">
                        <span class="renge-bg"></span>
                        <span class="range-choose"><cite id="TimeLongWid"></cite></span>
                        <input type="range" min="1" max="24"  step="1" id="TimeLong" value="1"／>
                    </p>
                    <span><cite id="TimeLongText">1</cite>个月</span>    
                </div>
                <div class="fm-money clearfix">
                    <label>应用购买费用</label>
                    <span class="fn-tips" data-tips="创建和调试应用时，无需支付费用，应用正常运行后才会提请您支付该费用。"><cite id="need-money">123.00</cite>元</span>
                </div>
                <div class="fm-aft-money clearfix">
                    <label>按小时结算项</label>
                    <p><span id="aft-memory-box" class="fn-tips" data-tips="创建和调试应用时，内存是免费的，正常运行后才会按小时扣费，请保持您的账户有一定的可用额度。">内存<cite id="aft-memory"></cite>元/GB·小时；</span><span id="aft-disk-box"  class="fn-tips" data-tips="创建和调试应用时，磁盘是免费的，正常运行后才会按小时扣费，请保持您的账户有一定的可用额度。">磁盘<cite id="aft-disk"></cite>元/GB·小时；</span><span id="aft-net-box" class="fn-tips" data-tips="创建和调试应用时，流量是免费的，正常运行后才会按小时扣费，请保持您的账户有一定的可用额度。">流量<cite id="aft-net"></cite>元/GB</span></p>
                </div>
            </div>
            <!-- 费用估算 end -->
			<div class="fm-btn clearfix">
				<a class="greenbtn" id="mirror_first" style="cursor: pointer;">下一步</a>
			</div>			
        </form>
    </section>
    <!-- new end -->
</section>
<script>
$(function(){
    //// ww-2016-12-6 选择 groupname start
    //弹出层
    function FnLayer(textTit){
        var oDiv = '<div class="layerbg"><div class="layermain"></div></div>';
        var oCloseBtn = '<a href="javascript:;" class="closebtn fn-close"><i class="fa fa-times"></i></a>';
        var oTit = '<p class="layer-tit">'+ textTit +'</p>';
        var oInput ='<p class="input-css"><input name="" type="text" value="" /></p>';
        var oLink = '<p class="layerlink"><a href="javascript:;" class="fn-sure">确定</a><a href="javascript:;" class="fn-close">取消</a></p>';
        $("body").append(oDiv);
        $("div.layermain").append(oCloseBtn,oTit);
        $("div.layermain").append(oInput);
        $("div.layermain").append(oLink);
        $(".fn-close").click(function(){
             $("div.layerbg").remove();
             $(".input-css input").prop("value","");
             $("#group-name").find("option[value='-1']").prop("selected",true);
        });
        $(".fn-sure").click(function(){
            if(inputText == ""){
                swal("您还没有输入组名！")
                return false;
            }else{
                var inputText = $(".input-css input").val();
                var tenant_name = $("#tenantName").val();
                ///ajax start

                $.ajax({
                    type : "post",
                    url : "/ajax/" + tenant_name  + "/group/add",
                    data : {
                        group_name : inputText
                    },
                    cache : false,
                    beforeSend : function(xhr, settings) {
                        var csrftoken = $.cookie('csrftoken');
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    },
                    success : function(msg) {
                        if(msg.ok){
                            var  group_id = msg.group_id;
                            var  group_name = msg.group_name;
                            var  Option = "<option value=" +  group_id + ">" + group_name + "</option>";
                            $("div.layerbg").remove();
                            $(".input-css input").prop("value","");
                            $("#group-name option").eq(0).after(Option);
                            $("#group-name option").each(function(){
                                var oVal = $(this).prop("value");
                                if(oVal == group_id){
                                    $(this).prop("selected",true);
                                }
                            });
                        }else{
                            swal(msg.info);
                        }
                    },
                    error : function() {
                        swal("系统异常,请重试");
                    }
                });
                
                ///ajax end
            }
              
        });   
    }
    //  弹出层
    $("#group-name").change(function(){
     var groupName=$("#group-name option:selected").val();
        //console.log(groupName);
        if(groupName == -2) {
            FnLayer("请输入新增组名");  
        }
    });
    //// ww-2016-12-6 选择 groupname end 
    
    // 滑块 开始 
    function FnRange(inputid,textid,widid,num){
        var range= document.getElementById(inputid);
        var result = document.getElementById(textid);
        var wid = document.getElementById(widid);
        var maxnum = range.getAttribute("max");
        cachedRangeValue = /*localStorage.rangeValue ? localStorage.rangeValue :*/ num; 
        // 检测浏览器
        var o = document.createElement('input');
        o.type = 'range';
        if ( o.type === 'text' ) alert('不好意思，你的浏览器还不够酷，试试最新的浏览器吧。');
        range.value = cachedRangeValue;
        wid.style.width = (range.value-num)/(maxnum-num)*100 + "%";
        range.addEventListener("mouseup", function() {
            if(inputid == "OneMemory"){
                if(range.value >= 128 && range.value < 256){
                    result.innerHTML = "128M";
                }else if(range.value >= 256 && range.value < 512){
                    result.innerHTML = "256M";
                }else if(range.value >= 512 && range.value < 1024){
                    result.innerHTML = "512M";
                }else if(range.value >= 1024 && range.value < 2048){
                    result.innerHTML = "1G";
                }else if(range.value >= 2048 && range.value < 3072){
                    result.innerHTML = "2G";
                }else if(range.value >= 3072 && range.value < 4096){
                    result.innerHTML = "3G";
                }else if(range.value >= 4096 && range.value < 5120){
                    result.innerHTML = "4G";
                }else if(range.value >= 5120 && range.value < 6144){
                    result.innerHTML = "5G";
                }else if(range.value >= 6144 && range.value < 7168){
                    result.innerHTML = "6G";
                }else if(range.value >= 7168 && range.value < 8100){
                   result.innerHTML = "7G";
                }else{
                   result.innerHTML = "8G";
                }
            }else{
               result.innerHTML = range.value; 
            }
            wid.style.width = (range.value-num)/(maxnum-num)*100 + "%";
            //alert("你选择的值是：" + range.value + ". 我现在正在用本地存储保存此值。在现代浏览器上刷新并检测。");
            //localStorage ? (localStorage.rangeValue = range.value) : alert("数据保存到了数据库或是其他什么地方。");
            //result.innerHTML = range.value;
            FnPrice();
        }, false);
        // 滑动时显示选择的值
        range.addEventListener("input", function() {
            if(inputid == "OneMemory"){
                if(range.value >= 128 && range.value < 256){
                    result.innerHTML = "128M";
                }else if(range.value >= 256 && range.value < 512){
                    result.innerHTML = "256M";
                }else if(range.value >= 512 && range.value < 1024){
                    result.innerHTML = "512M";
                }else if(range.value >= 1024 && range.value < 2048){
                    result.innerHTML = "1G";
                }else if(range.value >= 2048 && range.value < 3072){
                    result.innerHTML = "2G";
                }else if(range.value >= 3072 && range.value < 4096){
                    result.innerHTML = "3G";
                }else if(range.value >= 4096 && range.value < 5120){
                    result.innerHTML = "4G";
                }else if(range.value >= 5120 && range.value < 6144){
                    result.innerHTML = "5G";
                }else if(range.value >= 6144 && range.value < 7168){
                    result.innerHTML = "6G";
                }else if(range.value >= 7168 && range.value < 8100){
                   result.innerHTML = "7G";
                }else{
                   result.innerHTML = "8G";
                }
            }else{
               result.innerHTML = range.value; 
            }
            wid.style.width = (range.value-num)/(maxnum-num)*100 + "%";

        }, false);
    }
    
    FnRange("OneMemory","OneMemoryText","OneMemoryWid",128);
    FnRange("NodeNum","NodeText","NodeWid",1);
    FnRange("Disk","DiskText","DiskWid",1);
    FnRange("TimeLong","TimeLongText","TimeLongWid",1);
    
   
   
    
    // 滑动框 结束
    
    //计算价格
    var before_memory= $("#pre_paid_memory_price").attr("value");
    var before_disk= $("#pre_paid_disk_price").attr("value");
    var before_net= $("#post_paid_net_price").attr("value");
    var after_memory= $("#post_paid_memory_price").attr("value");
    var after_disk= $("#post_paid_disk_price").attr("value");
    var after_net= $("#post_paid_net_price").attr("value");
    $("#aft-memory").html(after_memory);
    $("#aft-disk").html(after_disk);
    $("#aft-net").html(after_net);

    FnPrice();

    function FnPrice(){
        var  memory_num = parseInt(document.getElementById("OneMemoryText").innerHTML);
        if(memory_num > 10){
            memory_num = memory_num / 1024;
        }
        var node_num = parseInt(document.getElementById("NodeText").innerHTML);
        var Disk_num = parseInt(document.getElementById("DiskText").innerHTML);
        var time_num = parseInt(document.getElementById("TimeLongText").innerHTML);
        var memory_onoff = document.getElementById("MoneyBefore").checked;
        var disk_onoff = document.getElementById("DiskBefore").checked;
        var onehour;
        //计算
        if(memory_onoff == true && disk_onoff == true){
            onehour = before_memory * memory_num  +  before_disk * Disk_num;
            Fnmemory();
        }else if(memory_onoff == true && disk_onoff != true){
            onehour = before_memory * memory_num;
            Fnmemory();
        }else if(memory_onoff != true && disk_onoff == true){
            onehour = before_disk * Disk_num;
            Fnmemory();
        }else{
            onehour = 0;
            Fnmemory();
        }
        //计算 
        function Fnmemory(){
            var total_money= onehour * 24 * time_num  *30 * 4 * node_num;
            var buy_money;
            if(time_num>=12){
                buy_money = onehour * 24 * time_num *1.5 *30;
            }else{
                buy_money = onehour * 24 * time_num *2*30;
            }
            $("#need-money").html(total_money.toFixed(2));
        }
    }
    ///
    function toDecimal2(x){
        var f = parseFloat(x);
        if (isNaN(f)) {
            return false;
        }
        var f = Math.round(x * 100) / 100;
        var s = f.toString();
        var rs = s.indexOf('.');
        if (rs < 0) {
            rs = s.length;
            s += '.';
        }
        while (s.length <= rs + 2) {
            s += '0';
        }
        return s;
    }
    ///
    // 计算价格结束

    // 显示 隐藏
    $("#MoneyBefore").change(function(){
        var onoff = $("#MoneyBefore").prop("checked");
        if(onoff == true){
            // $(".fn-memory-node").show();
            $("#aft-memory-box").hide();
        }else{
            //$(".fn-memory-node").hide();
            $("#aft-memory-box").show();
        }
        FnPrice();
    });
    $("#MoneyAfter").change(function(){
        
        var onoff = $("#MoneyAfter").prop("checked");
        if(onoff == false){
            //$(".fn-memory-node").show();
            $("#aft-memory-box").hide();
        }else{
            //$(".fn-memory-node").hide();
            $("#aft-memory-box").show();
        }
        FnPrice();
    });
    $("#DiskBefore").change(function(){
        var onoff = $("#DiskBefore").prop("checked");
        if(onoff == true){
            $(".fn-disk").show();
            $("#aft-disk-box").hide();
        }else{
            $(".fn-disk").hide();
            $("#aft-disk-box").show();
        }
        FnPrice();
    });
    $("#DiskAfter").change(function(){
        var onoff = $("#After").prop("checked");
        if(onoff == false){
            $(".fn-disk").show();
            $("#aft-disk-box").hide();
        }else{
            $(".fn-disk").hide();
            $("#aft-disk-box").show();
        }
        FnPrice();
    });
    // 输入框输入样式

    // 01 输入用户名
    $('#create_name').blur(function(){
        var appName = $(this).val();
        //var checkReg = /^[a-z][a-z0-9-]*[a-z0-9]$/;
        //var result = true;
        if(appName == ""){
            $('#create_name_notice').slideDown();
            return;
        }else{
            $('#create_name_notice').slideUp();
        }
    });
    // 01 end 
    //  镜像地址 start
    $('#mirror-address').blur(function(){
        var mirrorName = $(this).val();
        if(mirrorName == ""){
            $('#mirror_address_notice').slideDown();
            return;
        }else{
            $('#mirror_address_notice').slideUp();
        }
    });
    // 镜像地址  end
    
    /// 从镜像地址提交 
    $("#mirror_first").click(function(){
        var appname = $("#create_name").val();
        var groupname = $("#group-name option:selected").html();
        var groupid = $("#group-name option:selected").attr("value");
        var service_code_from = "gitlab_new";
        var myWay = $(".fn-way").attr("data-action");
        var code_url;
        var code_id;
        var code_branch;
        var code_branch_id;
        var memory_onoff = $("#MoneyBefore").prop("checked");
        var disk_onoff = $("#DiskBefore").prop("checked");
        if(memory_onoff == true && disk_onoff == true){
            var memory_num = parseInt($("#OneMemoryText").html());
            var node_num = parseInt($("#NodeText").html());
            var disk_num = parseInt($("#NodeText").html());
            var time_num = parseInt($("#TimeLongText").html());
        }else if(memory_onoff == true && disk_onoff == false ){
            var memory_num = parseInt($("#OneMemoryText").html());
            var node_num = parseInt($("#NodeText").html());
            var disk_num = 0;
            var time_num = parseInt($("#TimeLongText").html());
        }else if(memory_onoff == false && disk_onoff == true){
            var memory_num = parseInt($("#OneMemoryText").html());
            var node_num = parseInt($("#NodeText").html());
            var disk_num = parseInt($("#NodeText").html());
            var time_num = parseInt($("#TimeLongText").html());
        }else{
            var memory_num = parseInt($("#OneMemoryText").html());
            var node_num = parseInt($("#NodeText").html());
            var disk_num = 0;
            var time_num = 0;
        }
        if(appname == ""){
            $("#create_name_notice").show();
            return;
        }else{
            $("#create_name_notice").hide();
        }
        var image_url = $('#mirror-address').val();
        if(image_url == ""){
            $('#mirror_address_notice').slideDown();
            return;
        }else{
            $('#mirror_address_notice').slideUp();
        }

//        $('#mirror-address').blur(function(){
//            var mirrorName = $(this).val();
//            if(mirrorName == ""){
//                $('#mirror_address_notice').slideDown();
//                return;
//            }else{
//                $('#mirror_address_notice').slideUp();
//            }
//        });
        ///
        $("#mirror_first").attr('disabled', true);
        var tenantName= $('#tenantName').val();
        $.ajax({
            type : "post",
            url : "/apps/" + tenantName + "/image-create/",
            data : {
                "create_app_name" : appname,
                "groupname" : groupname,
                "select_group_id" : groupid,
                "image_url" : image_url,
                "memory_pay_method" : memory_onoff ? "prepaid":"postpaid",
                "disk_pay_method" : disk_onoff ? "prepaid":"postpaid",
                "service_min_memory" : memory_num,
                "service_min_node" : node_num,
                "disk_num" : disk_num,
                "pre_paid_period" : time_num
            },
            cache : false,
            beforeSend : function(xhr, settings) {
                var csrftoken = $.cookie('csrftoken');
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            },
            success : function(msg) {
                var dataObj = msg;
                if (dataObj["status"] == "over_memory") {
                    swal("资源已达上限，不能创建");
                } else if (dataObj["status"] == "over_money") {
                    swal("余额不足，不能创建");
                } else if (dataObj["status"] == "empty") {
                    swal("应用名称不能为空");
                }else if (dataObj["status"] == "success") {
                    var id = dataObj["id"];
                    window.location.href = "/apps/"+tenantName+"/image-params?id="+id;
                }else if (dataObj["status"] == "failure"){
                    swal("创建失败");
                }else if(dataObj["status"] == "owed"){
                    swal("您已欠费,请及时充值");
                }else if(dataObj["status"] == "no_image_url"){
                    swal("请填写镜像路径")
                }
                else {
                    swal("创建失败");
                }
                $("#mirror_first").attr('disabled', false);
            },
            error : function() {
                swal("系统异常,请重试");
                $("#mirror_first").attr('disabled', false);
            }
        });
        ///

    }); 
    /// 从镜像地址提交
    

    ////tips
    $(".fn-tips").mouseover(function(){
        var tips = $(this).attr("data-tips");
        var pos = $(this).attr("data-position");
        var x = $(this).offset().left;
        var y = $(this).offset().top;
        var oDiv='<div class="tips-box"><p><span>'+ tips +'</span><cite></cite></p></div>';
        $("body").append(oDiv);
        var oDivheight = $(".tips-box").height();
        var oDivwidth = $(".tips-box").width();
        var othiswid = $(this).width();
        var othisheight = $(this).height();
        if(pos){
            if(pos == "top"){
                //
                $(".tips-box").css({"top":y-oDivheight -25});
                if(oDivwidth > othiswid){
                    $(".tips-box").css({"left":x-(oDivwidth-othiswid)/2});
                }else if(oDivwidth < othiswid){
                    $(".tips-box").css({"left":x + (othiswid - oDivwidth)/2});
                }else{
                    $(".tips-box").css({"left":x});
                }
                 $(".tips-box").find("cite").addClass("top");
                //
            }else if(pos == "bottom"){
                //
                $(".tips-box").css({"top":y + othisheight + 25});
                if(oDivwidth > othiswid){
                    $(".tips-box").css({"left":x-(oDivwidth-othiswid)/2});
                }else if(oDivwidth < othiswid){
                    $(".tips-box").css({"left":x + (othiswid - oDivwidth)/2});
                }else{
                    $(".tips-box").css({"left":x});
                }
                $(".tips-box").find("cite").addClass("bottom");
                //
            }else if(pos == "left"){
                $(".tips-box").css({"top":y+5,"left":x-othiswid-5});
                 $(".tips-box").find("cite").addClass("left");
            }else if(pos == "right"){
                $(".tips-box").css({"top":y+5,"left":x+othiswid+5});
                 $(".tips-box").find("cite").addClass("right");
            }else{
                //
                $(".tips-box").css({"top":y-oDivheight -25});
                if(oDivwidth > othiswid){
                    $(".tips-box").css({"left":x-(oDivwidth-othiswid)/2});
                }else if(oDivwidth < othiswid){
                    $(".tips-box").css({"left":x + (othiswid - oDivwidth)/2});
                }else{
                    $(".tips-box").css({"left":x});
                }
                 $(".tips-box").find("cite").addClass("top");
                //
            }         
        }else{
            //
            $(".tips-box").css({"top":y-oDivheight -25});
            if(oDivwidth > othiswid){
                $(".tips-box").css({"left":x-(oDivwidth-othiswid)/2});
            }else if(oDivwidth < othiswid){
                $(".tips-box").css({"left":x + (othiswid - oDivwidth)/2});
            }else{
                $(".tips-box").css({"left":x});
            }
            $(".tips-box").find("cite").addClass("top");
            //
        }
        
    });
    $(".fn-tips").mouseout(function(){
        $(".tips-box").remove();
    });
    ////tips end

    
});
</script>
{% endblock %}
